(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[232],{99376:function(e,t,r){"use strict";var n=r(35475);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},40257:function(e,t,r){"use strict";var n,i;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(44227)},44227:function(e){!function(){var t={229:function(e){var t,r,n,i=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c=[],u=!1,l=-1;function d(){u&&n&&(u=!1,n.length?c=n.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(n=c,c=[];++l<t;)n&&n[l].run();l=-1,t=c.length}n=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||u||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var a=r[e]={exports:{}},o=!0;try{t[e](a,a.exports,n),o=!1}finally{o&&delete r[e]}return a.exports}n.ab="//";var i=n(229);e.exports=i}()},58380:function(e,t,r){"use strict";let n;r.d(t,{V:function(){return e_}});var i=crypto;let a=e=>e instanceof CryptoKey,o=async(e,t)=>{let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await i.subtle.digest(r,t))},s=new TextEncoder,c=new TextDecoder;function u(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}function l(e,t,r){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967296-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function d(e){let t=new Uint8Array(4);return l(t,e),t}function h(e){return u(d(e.length),e)}async function p(e,t,r){let n=Math.ceil((t>>3)/32),i=new Uint8Array(32*n);for(let t=0;t<n;t++){let n=new Uint8Array(4+e.length+r.length);n.set(d(t+1)),n.set(e,4),n.set(r,4+e.length),i.set(await o("sha256",n),32*t)}return i.slice(0,t>>3)}let f=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},y=e=>{let t=e;t instanceof Uint8Array&&(t=c.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return f(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}};class w extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}w.code="ERR_JOSE_GENERIC";class m extends w{constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=n,this.payload=t}}m.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class E extends w{constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=n,this.payload=t}}E.code="ERR_JWT_EXPIRED";class g extends w{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}g.code="ERR_JOSE_ALG_NOT_ALLOWED";class A extends w{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}A.code="ERR_JOSE_NOT_SUPPORTED";class v extends w{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}v.code="ERR_JWE_DECRYPTION_FAILED";class S extends w{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}S.code="ERR_JWE_INVALID";class b extends w{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}b.code="ERR_JWS_INVALID";class K extends w{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}K.code="ERR_JWT_INVALID";class W extends w{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}W.code="ERR_JWK_INVALID";class C extends w{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}C.code="ERR_JWKS_INVALID";class R extends w{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}R.code="ERR_JWKS_NO_MATCHING_KEY";class T extends w{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}T.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class _ extends w{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}_.code="ERR_JWKS_TIMEOUT";class k extends w{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}k.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";var J=(e,t)=>{if(t.length<<3!==function(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new A(`Unsupported JWE Algorithm: ${e}`)}}(e))throw new S("Invalid Initialization Vector length")},P=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new S(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)},I=(e,t)=>{if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");let r=e.length,n=0,i=-1;for(;++i<r;)n|=e[i]^t[i];return 0===n};function O(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function H(e,t){return e.name===t}function D(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!H(e.algorithm,"AES-GCM"))throw O("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw O(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!H(e.algorithm,"AES-KW"))throw O("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw O(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw O("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!H(e.algorithm,"PBKDF2"))throw O("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!H(e.algorithm,"RSA-OAEP"))throw O("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(parseInt(e.algorithm.hash.name.slice(4),10)!==r)throw O(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}!function(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}(e,r)}function U(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}var x=(e,...t)=>U("Key must be ",e,...t);function M(e,t,...r){return U(`Key for the ${e} algorithm must be `,t,...r)}var $=e=>!!a(e)||e?.[Symbol.toStringTag]==="KeyObject";let N=["CryptoKey"];async function B(e,t,r,n,a,o){let s,c;if(!(t instanceof Uint8Array))throw TypeError(x(t,"Uint8Array"));let d=parseInt(e.slice(1,4),10),h=await i.subtle.importKey("raw",t.subarray(d>>3),"AES-CBC",!1,["decrypt"]),p=await i.subtle.importKey("raw",t.subarray(0,d>>3),{hash:`SHA-${d<<1}`,name:"HMAC"},!1,["sign"]),f=u(o,n,r,function(e){let t=new Uint8Array(8);return l(t,Math.floor(e/4294967296),0),l(t,e%4294967296,4),t}(o.length<<3)),y=new Uint8Array((await i.subtle.sign("HMAC",p,f)).slice(0,d>>3));try{s=I(a,y)}catch{}if(!s)throw new v;try{c=new Uint8Array(await i.subtle.decrypt({iv:n,name:"AES-CBC"},h,r))}catch{}if(!c)throw new v;return c}async function L(e,t,r,n,a,o){let s;t instanceof Uint8Array?s=await i.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(D(t,e,"decrypt"),s=t);try{return new Uint8Array(await i.subtle.decrypt({additionalData:o,iv:n,name:"AES-GCM",tagLength:128},s,u(r,a)))}catch{throw new v}}let G=async(e,t,r,n,i,o)=>{if(!a(t)&&!(t instanceof Uint8Array))throw TypeError(x(t,...N,"Uint8Array"));if(!n)throw new S("JWE Initialization Vector missing");if(!i)throw new S("JWE Authentication Tag missing");switch(J(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&P(t,parseInt(e.slice(-3),10)),B(e,t,r,n,i,o);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&P(t,parseInt(e.slice(1,4),10)),L(e,t,r,n,i,o);default:throw new A("Unsupported JWE Content Encryption Algorithm")}};var j=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};function F(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}var V=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];let z=async(e,t,r)=>{let n=await function(e,t,r){if(a(e))return D(e,t,r),e;if(e instanceof Uint8Array)return i.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(x(e,...N,"Uint8Array"))}(t,e,"unwrapKey");!function(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}(n,e);let o=await i.subtle.unwrapKey("raw",r,n,"AES-KW",...V);return new Uint8Array(await i.subtle.exportKey("raw",o))};async function X(e,t,r,n,o=new Uint8Array(0),c=new Uint8Array(0)){let l;if(!a(e))throw TypeError(x(e,...N));if(D(e,"ECDH"),!a(t))throw TypeError(x(t,...N));D(t,"ECDH","deriveBits");let f=u(h(s.encode(r)),h(o),h(c),d(n));return l="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,p(new Uint8Array(await i.subtle.deriveBits({name:e.algorithm.name,public:e},t,l)),n,f)}async function Y(e,t,r,n){!function(e){if(!(e instanceof Uint8Array)||e.length<8)throw new S("PBES2 Salt Input must be 8 or more octets")}(e);let o=u(s.encode(t),new Uint8Array([0]),e),c=parseInt(t.slice(13,16),10),l={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:o},d=await function(e,t){if(e instanceof Uint8Array)return i.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(a(e))return D(e,t,"deriveBits","deriveKey"),e;throw TypeError(x(e,...N,"Uint8Array"))}(n,t);if(d.usages.includes("deriveBits"))return new Uint8Array(await i.subtle.deriveBits(l,d,c));if(d.usages.includes("deriveKey"))return i.subtle.deriveKey(l,d,{length:c,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let q=async(e,t,r,n,i)=>{let a=await Y(i,e,n,t);return z(e.slice(-6),a,r)};function Q(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new A(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}var Z=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};let ee=async(e,t,r)=>{if(!a(t))throw TypeError(x(t,...N));if(D(t,e,"decrypt","unwrapKey"),Z(e,t),t.usages.includes("decrypt"))return new Uint8Array(await i.subtle.decrypt(Q(e),t,r));if(t.usages.includes("unwrapKey")){let n=await i.subtle.unwrapKey("raw",r,t,Q(e),...V);return new Uint8Array(await i.subtle.exportKey("raw",n))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function et(e){return F(e)&&"string"==typeof e.kty}let er=async e=>{if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new A('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new A('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new A('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new A('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),n=[t,e.ext??!1,e.key_ops??r],a={...e};return delete a.alg,delete a.use,i.subtle.importKey("jwk",a,...n)},en=e=>y(e),ei=e=>e?.[Symbol.toStringTag]==="KeyObject",ea=async(e,t,r,n,i=!1)=>{let a=e.get(t);if(a?.[n])return a[n];let o=await er({...r,alg:n});return i&&Object.freeze(t),a?a[n]=o:e.set(t,{[n]:o}),o};var eo=(e,t)=>{if(ei(e)){let r=e.export({format:"jwk"});return r.k?en(r.k):(n||(n=new WeakMap),ea(n,e,r,t))}return et(e)?e.k?y(e.k):(n||(n=new WeakMap),ea(n,e,e,t,!0)):e},es=i.getRandomValues.bind(i);function ec(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new A(`Unsupported JWE Algorithm: ${e}`)}}var eu=e=>es(new Uint8Array(ec(e)>>3));async function el(e,t){if(!F(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return y(e.k);case"RSA":if(void 0!==e.oth)throw new A('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return er({...e,alg:t});default:throw new A('Unsupported "kty" (Key Type) Parameter value')}}let ed=e=>e?.[Symbol.toStringTag],eh=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},ep=(e,t,r,n)=>{if(!(t instanceof Uint8Array)){if(n&&et(t)){if(et(t)&&"oct"===t.kty&&"string"==typeof t.k&&eh(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!$(t))throw TypeError(M(e,t,...N,"Uint8Array",n?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${ed(t)} instances for symmetric algorithms must be of type "secret"`)}},ef=(e,t,r,n)=>{if(n&&et(t))switch(r){case"sign":if("oct"!==t.kty&&"string"==typeof t.d&&eh(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if("oct"!==t.kty&&void 0===t.d&&eh(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!$(t))throw TypeError(M(e,t,...N,n?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${ed(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${ed(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${ed(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${ed(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${ed(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function ey(e,t,r,n){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?ep(t,r,n,e):ef(t,r,n,e)}var ew=ey.bind(void 0,!1);async function em(e,t,r,n,i){return G(e.slice(0,7),t,r,n,i,new Uint8Array(0))}async function eE(e,t,r,n,i){switch(ew(e,t,"decrypt"),t=await eo?.(t,e)||t,e){case"dir":if(void 0!==r)throw new S("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new S("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i,o;if(!F(n.epk))throw new S('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!function(e){if(!a(e))throw TypeError(x(e,...N));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}(t))throw new A("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await el(n.epk,e);if(void 0!==n.apu){if("string"!=typeof n.apu)throw new S('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=y(n.apu)}catch{throw new S("Failed to base64url decode the apu")}}if(void 0!==n.apv){if("string"!=typeof n.apv)throw new S('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{o=y(n.apv)}catch{throw new S("Failed to base64url decode the apv")}}let c=await X(s,t,"ECDH-ES"===e?n.enc:e,"ECDH-ES"===e?ec(n.enc):parseInt(e.slice(-5,-2),10),i,o);if("ECDH-ES"===e)return c;if(void 0===r)throw new S("JWE Encrypted Key missing");return z(e.slice(-6),c,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new S("JWE Encrypted Key missing");return ee(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let a;if(void 0===r)throw new S("JWE Encrypted Key missing");if("number"!=typeof n.p2c)throw new S('JOSE Header "p2c" (PBES2 Count) missing or invalid');let o=i?.maxPBES2Count||1e4;if(n.p2c>o)throw new S('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof n.p2s)throw new S('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{a=y(n.p2s)}catch{throw new S("Failed to base64url decode the p2s")}return q(e,t,r,n.p2c,a)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new S("JWE Encrypted Key missing");return z(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let i,a;if(void 0===r)throw new S("JWE Encrypted Key missing");if("string"!=typeof n.iv)throw new S('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof n.tag)throw new S('JOSE Header "tag" (Authentication Tag) missing or invalid');try{i=y(n.iv)}catch{throw new S("Failed to base64url decode the iv")}try{a=y(n.tag)}catch{throw new S("Failed to base64url decode the tag")}return em(e,t,r,i,a)}default:throw new A('Invalid or unsupported "alg" (JWE Algorithm) header value')}}ey.bind(void 0,!0);var eg=function(e,t,r,n,i){let a;if(void 0!==i.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let o of(a=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!a.has(o))throw new A(`Extension Header Parameter "${o}" is not recognized`);if(void 0===i[o])throw new e(`Extension Header Parameter "${o}" is missing`);if(a.get(o)&&void 0===n[o])throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(n.crit)},eA=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function ev(e,t,r){let n,i,a,o,l,d,h;if(!F(e))throw new S("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new S("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new S("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new S("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new S("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new S("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new S("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new S("JWE AAD incorrect type");if(void 0!==e.header&&!F(e.header))throw new S("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!F(e.unprotected))throw new S("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=y(e.protected);n=JSON.parse(c.decode(t))}catch{throw new S("JWE Protected Header is invalid")}if(!j(n,e.header,e.unprotected))throw new S("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let p={...n,...e.header,...e.unprotected};if(eg(S,new Map,r?.crit,n,p),void 0!==p.zip)throw new A('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:f,enc:w}=p;if("string"!=typeof f||!f)throw new S("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof w||!w)throw new S("missing JWE Encryption Algorithm (enc) in JWE Header");let m=r&&eA("keyManagementAlgorithms",r.keyManagementAlgorithms),E=r&&eA("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(m&&!m.has(f)||!m&&f.startsWith("PBES2"))throw new g('"alg" (Algorithm) Header Parameter value not allowed');if(E&&!E.has(w))throw new g('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{i=y(e.encrypted_key)}catch{throw new S("Failed to base64url decode the encrypted_key")}let v=!1;"function"==typeof t&&(t=await t(n,e),v=!0);try{a=await eE(f,t,i,p,r)}catch(e){if(e instanceof TypeError||e instanceof S||e instanceof A)throw e;a=eu(w)}if(void 0!==e.iv)try{o=y(e.iv)}catch{throw new S("Failed to base64url decode the iv")}if(void 0!==e.tag)try{l=y(e.tag)}catch{throw new S("Failed to base64url decode the tag")}let b=s.encode(e.protected??"");d=void 0!==e.aad?u(b,s.encode("."),s.encode(e.aad)):b;try{h=y(e.ciphertext)}catch{throw new S("Failed to base64url decode the ciphertext")}let K={plaintext:await G(w,a,h,o,l,d)};if(void 0!==e.protected&&(K.protectedHeader=n),void 0!==e.aad)try{K.additionalAuthenticatedData=y(e.aad)}catch{throw new S("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(K.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(K.unprotectedHeader=e.header),v)?{...K,key:t}:K}async function eS(e,t,r){if(e instanceof Uint8Array&&(e=c.decode(e)),"string"!=typeof e)throw new S("Compact JWE must be a string or Uint8Array");let{0:n,1:i,2:a,3:o,4:s,length:u}=e.split(".");if(5!==u)throw new S("Invalid Compact JWE");let l=await ev({ciphertext:o,iv:a||void 0,protected:n,tag:s||void 0,encrypted_key:i||void 0},t,r),d={plaintext:l.plaintext,protectedHeader:l.protectedHeader};return"function"==typeof t?{...d,key:l.key}:d}var eb=e=>Math.floor(e.getTime()/1e3);let eK=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;var eW=e=>{let t;let r=eK.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(31557600*n)}return"-"===r[1]||"ago"===r[4]?-t:t};let eC=e=>e.toLowerCase().replace(/^application\//,""),eR=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e)));var eT=(e,t,r={})=>{let n,i;try{n=JSON.parse(c.decode(t))}catch{}if(!F(n))throw new K("JWT Claims Set must be a top-level JSON object");let{typ:a}=r;if(a&&("string"!=typeof e.typ||eC(e.typ)!==eC(a)))throw new m('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:o=[],issuer:s,subject:u,audience:l,maxTokenAge:d}=r,h=[...o];for(let e of(void 0!==d&&h.push("iat"),void 0!==l&&h.push("aud"),void 0!==u&&h.push("sub"),void 0!==s&&h.push("iss"),new Set(h.reverse())))if(!(e in n))throw new m(`missing required "${e}" claim`,n,e,"missing");if(s&&!(Array.isArray(s)?s:[s]).includes(n.iss))throw new m('unexpected "iss" claim value',n,"iss","check_failed");if(u&&n.sub!==u)throw new m('unexpected "sub" claim value',n,"sub","check_failed");if(l&&!eR(n.aud,"string"==typeof l?[l]:l))throw new m('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof r.clockTolerance){case"string":i=eW(r.clockTolerance);break;case"number":i=r.clockTolerance;break;case"undefined":i=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,f=eb(p||new Date);if((void 0!==n.iat||d)&&"number"!=typeof n.iat)throw new m('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new m('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>f+i)throw new m('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new m('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=f-i)throw new E('"exp" claim timestamp check failed',n,"exp","check_failed")}if(d){let e=f-n.iat;if(e-i>("number"==typeof d?d:eW(d)))throw new E('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-i)throw new m('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function e_(e,t,r){let n=await eS(e,t,r),i=eT(n.protectedHeader,n.plaintext,r),{protectedHeader:a}=n;if(void 0!==a.iss&&a.iss!==i.iss)throw new m('replicated "iss" claim header parameter mismatch',i,"iss","mismatch");if(void 0!==a.sub&&a.sub!==i.sub)throw new m('replicated "sub" claim header parameter mismatch',i,"sub","mismatch");if(void 0!==a.aud&&JSON.stringify(a.aud)!==JSON.stringify(i.aud))throw new m('replicated "aud" claim header parameter mismatch',i,"aud","mismatch");let o={payload:i,protectedHeader:a};return"function"==typeof t?{...o,key:n.key}:o}}}]);